<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>SpellLearning Configuration Demo</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }
        h1 {
            color: #7ec8e3;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #9d65c9;
            border-bottom: 1px solid #9d65c9;
            padding-bottom: 5px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .card {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #333;
        }
        .card h3 {
            margin: 0 0 10px 0;
            color: #7ec8e3;
        }
        .card p {
            margin: 5px 0;
            font-size: 13px;
            color: #aaa;
        }
        .param {
            display: flex;
            justify-content: space-between;
            padding: 3px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .param-name { color: #ccc; }
        .param-value { color: #7ec8e3; font-family: monospace; }
        canvas {
            border: 1px solid #444;
            border-radius: 5px;
            background: #0a0a15;
        }
        .demo-canvas {
            width: 100%;
            height: 200px;
        }
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        select, button {
            background: #252545;
            color: #eee;
            border: 1px solid #444;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        select:hover, button:hover {
            background: #353565;
        }
        .status {
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            margin-top: 10px;
        }
        .compare-row {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        .compare-col {
            flex: 1;
            text-align: center;
        }
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 11px;
            margin-left: 5px;
        }
        .badge-school { background: #5d4e7a; }
        .badge-element { background: #4a6741; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ¨ SpellLearning Configuration Demo</h1>

        <!-- Shape Profiles Section -->
        <div class="section">
            <h2>Shape Profiles</h2>
            <p>Each shape controls how nodes are distributed within a school's sector.</p>
            <div class="grid" id="shapes-grid"></div>
        </div>

        <!-- Growth Behaviors Section -->
        <div class="section">
            <h2>Growth Behaviors</h2>
            <p>Behaviors control tree topology - branching, hubs, and cross-connections.</p>
            <div class="grid" id="behaviors-grid"></div>
        </div>

        <!-- Interactive Demo -->
        <div class="section">
            <h2>Interactive Layout Demo</h2>
            <div class="controls">
                <select id="shapeSelect">
                    <option value="organic">Organic</option>
                    <option value="spiky">Spiky</option>
                    <option value="radial">Radial</option>
                    <option value="mountain">Mountain</option>
                    <option value="cloud">Cloud</option>
                    <option value="cascade">Cascade</option>
                    <option value="linear">Linear</option>
                    <option value="grid">Grid</option>
                </select>
                <select id="behaviorSelect">
                    <option value="fire_explosion">Fire Explosion</option>
                    <option value="gentle_bloom">Gentle Bloom</option>
                    <option value="mountain_builder">Mountain Builder</option>
                    <option value="portal_network">Portal Network</option>
                    <option value="spider_web">Spider Web</option>
                </select>
                <select id="spellCountSelect">
                    <option value="10">10 Spells</option>
                    <option value="20">20 Spells</option>
                    <option value="30">30 Spells</option>
                    <option value="50">50 Spells</option>
                </select>
                <button onclick="renderDemo()">Generate</button>
                <button onclick="renderComparison()">Compare All Shapes</button>
            </div>
            <canvas id="demoCanvas" width="800" height="400"></canvas>
            <div class="status" id="demoStatus">Select options and click Generate</div>
        </div>

        <!-- Shape Comparison -->
        <div class="section">
            <h2>Shape Comparison</h2>
            <div class="compare-row" id="compareRow"></div>
        </div>

        <!-- Edge Scoring Demo -->
        <div class="section">
            <h2>Edge Scoring Demo</h2>
            <div class="controls">
                <select id="fromElement">
                    <option value="fire">Fire Spell</option>
                    <option value="frost">Frost Spell</option>
                    <option value="shock">Shock Spell</option>
                    <option value="none">No Element</option>
                </select>
                <span style="line-height:35px">â†’</span>
                <select id="toElement">
                    <option value="fire">Fire Spell</option>
                    <option value="frost">Frost Spell</option>
                    <option value="shock">Shock Spell</option>
                    <option value="none">No Element</option>
                </select>
                <label><input type="checkbox" id="elementIsolation" checked> Element Isolation</label>
                <label><input type="checkbox" id="strictMode"> Strict Mode</label>
                <button onclick="calculateScore()">Calculate Score</button>
            </div>
            <div class="status" id="scoreStatus">Configure and click Calculate Score</div>
        </div>
    </div>

    <!-- Load modules -->
    <script>
        var settings = { schoolColors: {}, schoolVisibility: {}, treeGeneration: { llm: { enabled: false } } };
        function callCpp() { return null; }
    </script>
    <script src="modules/constants.js"></script>
    <script src="modules/state.js" onerror="console.log('state.js not critical')"></script>
    <script src="modules/config.js"></script>
    <script src="modules/edgeScoring.js"></script>
    <script src="modules/shapeProfiles.js"></script>
    <script src="modules/layoutEngine.js"></script>
    <script src="modules/growthBehaviors.js"></script>
    <script src="modules/growthDSL.js"></script>

    <script>
        // Render shape profiles cards
        function renderShapeCards() {
            var grid = document.getElementById('shapes-grid');
            if (!grid || typeof SHAPE_PROFILES === 'undefined') return;

            var shapes = Object.keys(SHAPE_PROFILES);
            shapes.forEach(function(shapeName) {
                var profile = SHAPE_PROFILES[shapeName];
                var card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h3>${profile.name || shapeName}</h3>
                    <p>${profile.description || ''}</p>
                    <div class="param"><span class="param-name">radiusJitter</span><span class="param-value">${profile.radiusJitter}</span></div>
                    <div class="param"><span class="param-name">angleJitter</span><span class="param-value">${profile.angleJitter}Â°</span></div>
                    <div class="param"><span class="param-name">tierSpacingMult</span><span class="param-value">${profile.tierSpacingMult}</span></div>
                    <div class="param"><span class="param-name">spreadMult</span><span class="param-value">${profile.spreadMult}</span></div>
                    <div class="param"><span class="param-name">densityMult</span><span class="param-value">${profile.densityMult}</span></div>
                    ${profile.taperSpread ? '<div class="param"><span class="param-name">taperSpread</span><span class="param-value">true (' + profile.taperAmount + ')</span></div>' : ''}
                    ${profile.clusterNodes ? '<div class="param"><span class="param-name">clusterNodes</span><span class="param-value">true</span></div>' : ''}
                `;
                grid.appendChild(card);
            });
        }

        // Render behavior cards
        function renderBehaviorCards() {
            var grid = document.getElementById('behaviors-grid');
            if (!grid || typeof GROWTH_BEHAVIORS === 'undefined') return;

            var behaviors = ['fire_explosion', 'gentle_bloom', 'mountain_builder', 'portal_network', 'spider_web'];
            behaviors.forEach(function(behaviorName) {
                var behavior = GROWTH_BEHAVIORS[behaviorName];
                if (!behavior) return;

                var school = '';
                if (typeof SCHOOL_DEFAULT_BEHAVIORS !== 'undefined') {
                    for (var s in SCHOOL_DEFAULT_BEHAVIORS) {
                        if (SCHOOL_DEFAULT_BEHAVIORS[s] === behaviorName) {
                            school = s;
                            break;
                        }
                    }
                }

                var card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h3>${behavior.name} ${school ? '<span class="badge badge-school">' + school + '</span>' : ''}</h3>
                    <p>${behavior.description || ''}</p>
                    <div class="param"><span class="param-name">branchingFactor</span><span class="param-value">${behavior.branchingFactor}</span></div>
                    <div class="param"><span class="param-name">branchStyle</span><span class="param-value">${behavior.branchStyle}</span></div>
                    <div class="param"><span class="param-name">verticalBias</span><span class="param-value">${behavior.verticalBias}</span></div>
                    <div class="param"><span class="param-name">spreadFactor</span><span class="param-value">${behavior.spreadFactor}</span></div>
                    <div class="param"><span class="param-name">hubProbability</span><span class="param-value">${behavior.hubProbability}</span></div>
                    <div class="param"><span class="param-name">crossConnections</span><span class="param-value">${behavior.crossConnectionDensity}</span></div>
                    <div class="param"><span class="param-name">phases</span><span class="param-value">${behavior.phases ? behavior.phases.length : 0}</span></div>
                `;
                grid.appendChild(card);
            });
        }

        // Render demo canvas
        function renderDemo() {
            var canvas = document.getElementById('demoCanvas');
            var ctx = canvas.getContext('2d');
            var shapeName = document.getElementById('shapeSelect').value;
            var behaviorName = document.getElementById('behaviorSelect').value;
            var spellCount = parseInt(document.getElementById('spellCountSelect').value);

            ctx.fillStyle = '#0a0a15';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (typeof LayoutEngine === 'undefined') {
                ctx.fillStyle = '#f44';
                ctx.fillText('LayoutEngine not loaded', 50, 50);
                return;
            }

            var sector = LayoutEngine.calculateSector(0, 1); // Full circle for demo
            sector.startAngle = 0;
            sector.endAngle = 360;
            sector.usableAngle = 360;

            var positions = LayoutEngine.generateGrid(sector, spellCount, shapeName, Date.now());

            // Apply growth behavior if available
            if (typeof GROWTH_BEHAVIORS !== 'undefined' && GROWTH_BEHAVIORS[behaviorName]) {
                var rng = function() { return Math.random(); };
                positions = LayoutEngine.applyGrowthBehavior(positions, behaviorName, rng);
            }

            var centerX = canvas.width / 2;
            var centerY = canvas.height / 2;
            var scale = 0.8;

            // Draw connections (simple radial for demo)
            ctx.strokeStyle = 'rgba(126, 200, 227, 0.3)';
            ctx.lineWidth = 1;
            positions.forEach(function(pos, i) {
                if (i > 0) {
                    var parent = positions[Math.max(0, i - 1 - Math.floor(Math.random() * 3))];
                    ctx.beginPath();
                    ctx.moveTo(centerX + parent.x * scale, centerY + parent.y * scale);
                    ctx.lineTo(centerX + pos.x * scale, centerY + pos.y * scale);
                    ctx.stroke();
                }
            });

            // Draw nodes
            positions.forEach(function(pos, i) {
                var x = centerX + pos.x * scale;
                var y = centerY + pos.y * scale;

                // Color by tier
                var tierColors = ['#4caf50', '#8bc34a', '#ffeb3b', '#ff9800', '#f44336'];
                var color = tierColors[pos.tier % tierColors.length];

                ctx.beginPath();
                ctx.arc(x, y, 6, 0, Math.PI * 2);
                ctx.fillStyle = color;
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 1;
                ctx.stroke();
            });

            // Draw center
            ctx.beginPath();
            ctx.arc(centerX, centerY, 10, 0, Math.PI * 2);
            ctx.fillStyle = '#7ec8e3';
            ctx.fill();

            document.getElementById('demoStatus').textContent =
                'Shape: ' + shapeName + ' | Behavior: ' + behaviorName +
                ' | Generated ' + positions.length + ' positions for ' + spellCount + ' spells';
        }

        // Compare all shapes
        function renderComparison() {
            var row = document.getElementById('compareRow');
            row.innerHTML = '';

            var shapes = ['organic', 'spiky', 'mountain', 'radial'];
            var spellCount = 15;

            shapes.forEach(function(shapeName) {
                var col = document.createElement('div');
                col.className = 'compare-col';

                var canvas = document.createElement('canvas');
                canvas.width = 200;
                canvas.height = 200;
                canvas.style.background = '#0a0a15';
                canvas.style.borderRadius = '5px';

                var ctx = canvas.getContext('2d');
                ctx.fillStyle = '#0a0a15';
                ctx.fillRect(0, 0, 200, 200);

                if (typeof LayoutEngine !== 'undefined') {
                    var sector = { startAngle: 0, endAngle: 360, usableAngle: 360, spokeAngle: 180 };
                    var positions = LayoutEngine.generateGrid(sector, spellCount, shapeName, 12345);

                    var centerX = 100, centerY = 100, scale = 0.4;

                    positions.forEach(function(pos) {
                        var x = centerX + pos.x * scale;
                        var y = centerY + pos.y * scale;
                        ctx.beginPath();
                        ctx.arc(x, y, 4, 0, Math.PI * 2);
                        ctx.fillStyle = '#7ec8e3';
                        ctx.fill();
                    });

                    ctx.beginPath();
                    ctx.arc(centerX, centerY, 6, 0, Math.PI * 2);
                    ctx.fillStyle = '#f44336';
                    ctx.fill();
                }

                col.appendChild(canvas);
                col.innerHTML += '<p>' + shapeName + '</p>';
                row.appendChild(col);
            });
        }

        // Calculate edge score
        function calculateScore() {
            var fromEl = document.getElementById('fromElement').value;
            var toEl = document.getElementById('toElement').value;
            var isolation = document.getElementById('elementIsolation').checked;
            var strict = document.getElementById('strictMode').checked;

            var fromSpell = { name: fromEl === 'none' ? 'Generic Spell' : fromEl.charAt(0).toUpperCase() + fromEl.slice(1) + 'ball', skillLevel: 0 };
            var toSpell = { name: toEl === 'none' ? 'Generic Spell 2' : toEl.charAt(0).toUpperCase() + toEl.slice(1) + ' Bolt', skillLevel: 25 };

            var settings = {
                elementIsolation: isolation,
                elementIsolationStrict: strict,
                scoring: { elementMatching: true, themeCoherence: true }
            };

            if (typeof scoreEdge === 'function') {
                var score = scoreEdge(fromSpell, toSpell, settings);
                var fromDetected = detectSpellElement(fromSpell);
                var toDetected = detectSpellElement(toSpell);

                var status = 'From: ' + fromSpell.name + ' (' + (fromDetected || 'no element') + ')\n';
                status += 'To: ' + toSpell.name + ' (' + (toDetected || 'no element') + ')\n';
                status += 'Settings: isolation=' + isolation + ', strict=' + strict + '\n';
                status += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
                status += 'SCORE: ' + score + ' (' + (score >= 0 ? 'âœ“ VALID' : 'âœ— FORBIDDEN') + ')';

                document.getElementById('scoreStatus').textContent = status;
            } else {
                document.getElementById('scoreStatus').textContent = 'scoreEdge function not available';
            }
        }

        // Initialize on load
        window.onload = function() {
            renderShapeCards();
            renderBehaviorCards();
            renderDemo();
            renderComparison();
        };
    </script>
</body>
</html>
